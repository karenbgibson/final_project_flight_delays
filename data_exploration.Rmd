---
title: "Data exploration"
output: html_notebook
editor_options: 
  chunk_output_type: inline
---

```{r}
library(tidyverse)
library(janitor)
```

```{r}
airlines <- read_csv("data/airlines.csv") %>% 
  clean_names()
  
airports <- read_csv("data/airports.csv") %>% 
  clean_names()

flights <- read_csv("data/flights.csv") %>% 
  clean_names()

planes <- read_csv("data/planes.csv") %>% 
  clean_names()

weather <- read_csv("data/weather.csv") %>% 
  clean_names()
```

Brief: 
They believe poor weather conditions are causing **too many delays** and want to invest in improving facilities, so that aircraft can take off in more types of weather. 

However, they do not fully understand **how serious weather related delays are**, and are **not sure what type of weather they should be most concerned about**. As part of investigating the effect of weather you should **investigate other factors** to understand **how important weather is in comparison to them**

They also want to understand **how they compare to other New York airports**.

Define New York airports: 
- Will investigate JFK and La Guardia as competitors/valid comparisons. These alongside Newark are the main hubs for New York city, carrying commercial passengers

```{r}
flights %>% 
  distinct(origin)

#only EWR, LGA and JFK info available. Meets NYC airport definition
```
```{r}
flights %>% 
  distinct(year)
```
```{r}
flights %>% 
  distinct(month)
```

Data includes all 3 NYC serving airports for every month in 2017.

```{r}
flights %>% 
  summarise(
    across(
      everything(),
      ~sum(is.na(.))
    ))
```
7810 missing values from departure time. Check if any of those times can be calculated based on other variables:

```{r}
flights %>% 
  filter(is.na(dep_time)) %>% 
  distinct(arr_time)
```

All flights with no dep_time also have no arrival time. Assume all were cancelled flights. 

US Dept of Transportation publishes cancelled flight numbers by airport. On review on 2017 data, cancelled flights for all months in each of JFK, LGA and EWR closely match the missing numbers in the flights dataset. Dep_time is dbl so cannot impute NAs to "cancelled" without changing variable to character string. Opting to add new cancelled variable. 

(https://www.transtats.bts.gov/HomeDrillChart_Month.asp?5ry_lrn4=FDEK&N44_Qry=E&5ry_Pn44vr4=DDD&5ry_Nv42146=DDD&heY_fryrp6lrn4=FDFG&heY_fryrp6Z106u=E)


```{r}
flights %>% 
  filter(is.na(dep_time)) %>% 
  mutate(month = as.numeric(month)) %>% 
  group_by(origin, month) %>% 
  summarise(count = n())
```

```{r}
flights <- flights %>% 
  mutate(cancelled = if_else(is.na(dep_time), TRUE, FALSE), .after = dep_time)
```

```{r}
# testing above code has worked:
flights %>% 
  filter(cancelled == TRUE) %>% 
  distinct(dep_time)
# all showing as NA, indicating code has worked
```
```{r}
# checking remaining NAs in other categories with consideration of new cancelled variable

flights %>% 
  filter(cancelled == FALSE) %>% 
  summarise(
    across(
      everything(),
      ~sum(is.na(.))
    ))
```


